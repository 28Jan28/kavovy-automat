// Funkce pro generování náhodného RFID čísla
function generateRandomRfid() {
  let rfid = '';
  for (let i = 0; i < 8; i++) {
    rfid += Math.floor(Math.random() * 10);
  }
  return rfid;
}

// Funkce pro přidání nového uživatele
async function addNewAdmin() {
  try {
    // Vygenerujeme náhodné RFID číslo
    const rfidCard = generateRandomRfid();
    console.log("Vygenerované RFID:", rfidCard);
    
    // Registrace nového uživatele
    const { data: authData, error: authError } = await supabaseClient.auth.signUp({
      email: 'jan.vydra@sfs.com',
      password: 'Kava2026',
      options: {
        emailRedirectTo: undefined // Zakázání email konfirmace
      }
    });
    
    if (authError) {
      console.error('Chyba při registraci:', authError);
      return false;
    }
    
    if (!authData.user) {
      console.error('Nepodařilo se vytvořit uživatele');
      return false;
    }
    
    // Počkat chvíli, aby se uživatel správně vytvořil
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    // Vytvoření profilu s admin rolí
    const { data: profileData, error: profileError } = await supabaseClient
      .from('profiles')
      .insert([
        { 
          id: authData.user.id,
          name: 'Jan Vydra',
          email: 'jan.vydra@sfs.com',
          credit: 100, // Začínat se 100 kreditem
          is_admin: true, // Admin role
          rfid_card: rfidCard
        }
      ]);
    
    if (profileError) {
      console.error('Chyba při vytváření profilu:', profileError);
      return false;
    }
    
    console.log("Uživatel Jan Vydra byl úspěšně přidán jako admin.");
    return true;
  } catch (error) {
    console.error('Neočekávaná chyba při přidávání uživatele:', error);
    return false;
  }
}

// Přidání uživatele a zobrazení výsledku
addNewAdmin().then(success => {
  if (success) {
    alert('Uživatel Jan Vydra byl úspěšně přidán jako admin.');
    window.location.reload(); // Obnovení stránky pro aktualizaci seznamu uživatelů
  } else {
    alert('Přidání uživatele Jana Vydry se nezdařilo. Zkontrolujte konzoli pro více detailů.');
  }
});